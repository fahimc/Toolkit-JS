<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>test</title>
		<meta name="author" content="Fahim" />
		<!-- <script type="text/javascript" src="../release/toolkitMax-v1001.js"></script> -->
		<script type="text/javascript" src="../lib/com/greensock/easing/EasePack.js"></script>
		<script type="text/javascript" src="../lib/com/greensock/plugins/CSSPlugin.js"></script>
		<script type="text/javascript" src="../lib/com/greensock/TweenLite.js"></script>
		<script type="text/javascript" src="../lib/com/utensil/JSInterface.js"></script>
		<script type="text/javascript" src="../lib/com/utensil/UtensilLight.js"></script>
		<script type="text/javascript" src="../lib/com/wezside/event/Event.js"></script>
		<script type="text/javascript" src="../lib/com/wezside/decorator/Layout.js"></script>
		<script type="text/javascript" src="../src/com/decorator/GridLayout.js"></script>
		<script type="text/javascript" src="../lib/com/wezside/decorator/ScrollLayout.js"></script>
		<script type="text/javascript" src="../lib/com/wezside/display/DisplayObject.js"></script>
		<script type="text/javascript" src="../lib/com/wezside/component/UIElement.js"></script>
		<script type="text/javascript" src="../lib/com/wezside/component/Sprite.js"></script>
		<script type="text/javascript" src="../lib/com/wezside/util/global.js"></script>
		<script type="text/javascript" src="../src/com/game/Engine.js"></script>
		<!-- Date: 2012-08-28 -->
		<style>
			* {
				margin: 0;
				padding: 0;
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-khtml-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
			body {
				overflow: hidden;
				background-color: #ccc;
			}

		</style>
		<script type="text/javascript">
			var man;
			var game;
			var sx;
			var sy;
			var px;
			var py;
			var move;
			function onLoad() {

				game = new Engine();
				game.width(500);
				game.height(500);
				game.cellSize(50);
				game.showGrid(true);
				//Event.addListener(game,game.event.READY,addObstacles);
				game.init();

				createObj();
				//createObj();
				//createObj();
				//createObj();

				//document.body.appendChild(obj.display);

				man = new Sprite();
				man.build();
				man.drawCircle(250, 250, 35, "#0f0");
				man.setStyle();
				man.arrange();
				game.addToCharacterLayer(man);
				
				
				var wall= new Sprite();
				wall.build();
				wall.drawRect(30, 30, 100,100, "yellow");
				wall.setStyle();
				wall.arrange();
				game.addToBackgroundLayer(wall);
				
				
				wall= new Sprite();
				wall.build();
				wall.drawCircle(330, 330, 60, "purple");
				wall.setStyle();
				wall.arrange();
				game.addToFrontLayer(wall);
				

				//game.findPathTo(man, 300, 1);

				Utensil.addListener(window, "resize", onResize);
				//Utensil.addListener(man.display, "mousedown", onMouseDown);
				if(isTouchDevice())
				{
					document.addEventListener("touchstart", onMouseUp, false);
					
				}else{
				Utensil.addListener(document, "mouseup", onMouseUp);
					
				}
			}

			function addObstacles() {

			}

			function onMouseDown(event) {
				sx = man.x();
				sy = man.y();
				Utensil.addListener(document, "mousemove", onMouseMove);
			}

			function onMouseUp(event) {
				//Utensil.removeListener(document, "mousemove", onMouseMove);
				
					px = Utensil.mouseX(document.body, event);
					py = Utensil.mouseY(document.body, event);
					game.astar.wipe();
					move = null;
					move = (game.findPathTo(man, px, py));
					nextMove(0);
				
			}

			function nextMove(index) {
				if (move && move[index]) {
					TweenLite.killTweensOf(man);
					TweenLite.to(man, 0.5, {
						x : move[index].x,
						y : move[index].y,
						onComplete : nextMove,
						onCompleteParams : [index + 1]
					})

				}
			}

			function onMouseMove(event) {

				man.x(Utensil.mouseX(document.body, event));
				man.y(Utensil.mouseY(document.body, event));

			}

			function isTouchDevice() {
				return "ontouchstart" in window;
			}

			function createObj() {
				var randomX = Math.floor(Math.random() * (499 - 1 + 1)) + 1;
				var randomY = Math.floor(Math.random() * (499 - 1 + 1)) + 1;

				var obj = new Sprite();
				obj.build();
				obj.drawRect(randomX, randomY,150, 35, "#f00");
				obj.setStyle();
				obj.arrange();
				game.addObstacle(obj);
				delete obj;
			}

			function onResize() {

			}
		</script>
	</head>
	<body onload="onLoad()">

	</body>
</html>
