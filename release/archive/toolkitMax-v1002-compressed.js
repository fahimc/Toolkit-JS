var Class={_super:function(e,t){e.baseConstructor[t].call(e)},extend:function(e,t){e.prototype=new t;e.prototype.baseConstructor=new t;return e.prototype}};window.Utensil={createElement:function(e){return document.createElement(e)},addChild:function(e){document.body.appendChild(e)},stageWidth:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},stageHeight:function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},getX:function(e,t){if(t){var n=0;var r=0;if(e.offsetParent){do{n+=e.offsetLeft;r+=e.offsetTop}while(e=e.offsetParent)}return n}return isNaN(parseInt(e.style.left.replace("px","")))?0:parseInt(e.style.left.replace("px",""))},getY:function(e,t){if(t){var n=0;if(e.offsetParent){do{n+=e.offsetTop}while(e=e.offsetParent)}return n}return isNaN(parseInt(e.style.top.replace("px","")))?0:parseInt(e.style.top.replace("px",""))},getWidth:function(e){return isNaN(parseInt(e.style.width.replace("px","")))?0:parseInt(e.style.width.replace("px",""))},getHeight:function(e){return isNaN(parseInt(e.style.height.replace("px","")))?0:parseInt(e.style.height.replace("px",""))},trace:function(){var e="";for(var t in arguments){e+=arguments[t]+","}alert(e)},resetStyle:function(e){e.style.position="absolute";e.style.margin="0";e.style.padding="0"},mouseX:function(e,t){if(t.touches){if(t.touches[0]&&t.touches[0].pageX)return t.touches[0].pageX}var n;if(t.pageX){n=t.pageX}else{n=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft}n-=e.offsetLeft;return n},mouseY:function(e,t){if(t.touches){if(t.touches[0]&&t.touches[0].pageY)return t.touches[0].pageY}var n;if(t.pageY){n=t.pageY}else{n=t.clientY+document.body.scrollTop+document.documentElement.scrollTop}n-=e.offsetTop;return n},mouseLeave:function(e){if(!e)var e=window.event;var t=window.event?e.srcElement:e.target;var n=e.relatedTarget?e.relatedTarget:e.toElement;while(n!=t&&n.nodeName!="BODY")n=n.parentNode;if(n==t)return},ImageLoader:function(e,t){var n=new Image;n.onload=function(){t(n)};n.src=e},postURL:function(e,t,n){n=n||"post";var r=document.createElement("form");r.setAttribute("method",n);r.setAttribute("action",e);var i=document.createElement("input");i.setAttribute("type","hidden");i.setAttribute("name","data");i.setAttribute("value",t);r.appendChild(i);document.body.appendChild(r);r.submit()},URLLoader:{xhttp:"",cb:"",load:function(e,t,n,r){this.cb=t;if(window.XMLHttpRequest){this.xhttp=new XMLHttpRequest}else{this.xhttp=new ActiveXObject("Microsoft.XMLHTTP")}if(!n)n="GET";if(n=="GET"&&r){e+="?"+r}var i=this;this.xhttp.onreadystatechange=function(){i.onStatus()};this.xhttp.open(n,e,true);if(n=="POST"){this.xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");this.xhttp.setRequestHeader("Content-length",r.length);this.xhttp.setRequestHeader("Connection","close")}try{this.xhttp.send(r)}catch(s){}},onStatus:function(e){if(this.xhttp.readyState==4){if(this.xhttp.status==200||window.location.href.indexOf("http")==-1){this.cb(this.xhttp.responseText,this.xhttp.responseXML)}else{}}else{}}},tweener:{index:0,rotate:function(e,t){if(Utensil.getTransformProperty()!="ie"){e.transform+=" rotate("+t+"deg)"}},scale:function(e,t){if(Utensil.getTransformProperty()!="ie"){e.transform+=" scale("+t+")"}},transition:function(e,t,n){if(Utensil.getTransformProperty()!="ie"){switch(t){case"left":e.transform+=" translateX("+n+") ";break;case"top":e.transform+=" translateY("+n+") ";break;case"rotateY":e.transform+=" rotateY("+n+"deg) ";e.transition+=Utensil.getTransformProperty()+"transform-style: preserve-3d; ";break;default:e.transition+=t+":"+n+";"}}},tranisitionEndList:{transition:"transitionEnd",OTransition:"oTransitionEnd",MSTransition:"msTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},TransitionEnd:function(){var e;var t=document.createElement("fakeelement");for(e in this.tranisitionEndList){if(t.style[e]!==undefined){return this.tranisitionEndList[e]}}t=null;e=null}},tween:function(e,t,n,r,i,s){function l(){f=null;a=null;o=null;Utensil.removeListener(e,Utensil.tweener.TransitionEnd(),l,false);if(i)i()}if(this.getTransformProperty()!="ie"){if(!t)t=1;if(!r)r="linear";if(!s){s="0s"}else{s+="s"}var o={transform:"",transition:"",filter:""};for(var u in n){if(this.tweener[u]){this.tweener[u](o,n[u])}else{this.tweener.transition(o,u,n[u])}}this.addListener(e,this.tweener.TransitionEnd(),l,false);var a=this.tweener.index++;var f=document.createElement("style");f.type="text/css";f.id="utensil-animate-"+a;f.innerHTML=".utensil-animate-"+a+"{";f.innerHTML+=o.transition;if(o.transform!="")f.innerHTML+=this.getTransformProperty()+"transform: "+o.transform+"; ";f.innerHTML+=this.getTransformProperty()+"transition: all"+" "+t+"s "+r+" "+s+"; ";f.innerHTML+="}";document.getElementsByTagName("head")[0].appendChild(f);e.className+=" utensil-animate-"+a}else{this.tweenIE(e,t,n,r,i,s)}},tweenIE:function(e,t,n,r,i,s){},getTransformProperty:function(e){var t=["transition","WebkitTransition","msTransition","MozTransition","OTransition"];var n;while(n=t.shift()){if(typeof document.body.style[n]!="undefined"){switch(n){case"transition":n="";break;case"WebkitTransition":n="-webkit-";break;case"MozTransition":n="-moz-";break;case"OTransition":n="-o-";break;case"msTransition":n="-ms-";break;default:n="ie"}return n}}return"ie"},Browser:{getInternetExplorerVersion:function(){var e=-1;if(navigator.appName=="Microsoft Internet Explorer"){var t=navigator.userAgent;var n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(n.exec(t)!=null)e=parseFloat(RegExp.$1)}return e},isIE:navigator.appVersion.indexOf("MSIE")!=-1,isIE9:function(){return Utensil.Browser.getInternetExplorerVersion()>8},isMobile:/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase())},getTarget:function(e){return e.currentTarget?e.currentTarget:e.srcElement},events:{},addListener:function(e,t,n){if(e.attachEvent){e.attachEvent("on"+t,n)}else{e.addEventListener(t,n)}},removeListener:function(e,t,n){if(e.detachEvent){e.detachEvent("on"+t,n)}else{e.removeEventListener(t,n)}},addPackage:function(e,t){var n=this;if(t&&!this[t]){this[t]={};n=this[t]}for(var r in e){var i=e[r];n[r]=i}}};var Event={COMPLETE:"EVENT_COMPLETE",PROGRESS:"EVENT_PROGRESS",addListener:function(e,t,n,r){var i=[];var s=arguments.length;for(var o=0;o<s;o++){i.push(arguments[o])}i=i.length>3?i.splice(3,i.length-1):[];if(!e.listeners)e.listeners={};if(typeof e.listeners[t]!="undefined"){e.listeners[t].push({scope:r,callback:n,args:i})}else{e.listeners[t]=[{scope:r,callback:n,args:i}]}},removeListener:function(e,t,n,r){if(typeof e.listeners[t]!="undefined"){var i=e.listeners[t].length;var s=[];for(var o=0;o<i;o++){var u=e.listeners[t][o];if(u.scope==r&&u.callback==n){}else{s.push(u)}}e.listeners[t]=s}},dispatch:function(e,t,n){var r=0;var i={type:t,target:n};var s=[];var o=arguments.length;for(var u=0;u<o;u++){s.push(arguments[u])}s=s.length>2?s.splice(2,s.length-1):[];s=[i].concat(s);if(typeof e.listeners[t]!="undefined"){var a=e.listeners[t].length;for(var u=0;u<a;u++){var f=e.listeners[t][u];if(f&&f.callback){f.args=s.concat(f.args);f.callback.apply(f.scope,f.args);r+=1}}}}};var ResourceManager={assetJson:[],assets:null,copyUrl:null,copy:null,currentIndex:0,currentAsset:null,images:[],totalAssets:0,preloadImages:true,addAssets:function(e){this.assetJson.push(e)},addCopy:function(e){if(typeof e=="string"){this.copyUrl=e}else{this.copy=e}},mergeObjects:function(){this.assets={};for(var e=0;e<this.assetJson.length;e++){for(prop in this.assetJson[e]){this.assets[prop]=this.assetJson[e][prop]}}this.assetJson=null},init:function(){this.currentIndex=0;this.checkAssetJson(this.currentIndex)},checkAssetJson:function(e){if(this.assetJson[e]){this.currentIndex=e;if(typeof this.assetJson[e]=="string"){Utensil.URLLoader.load(this.assetJson[e],this.onAssetLoaded)}else{this.onAssetLoaded()}}else{this.assetsInitialised()}},assetsInitialised:function(){this.currentIndex=0;this.mergeObjects();this.loadAsset()},loadAsset:function(){if(this.assets){var e=0;for(var t in this.assets){if(e==this.currentIndex){this.currentAsset=this.assets[t];this.currentAsset.name=t}e++}this.totalAssets=e;var n=this;if(this.currentAsset!=null&&this.currentAsset.path!=null){this.currentIndex++;var r=this.currentAsset.path.split(".");var i=r[r.length-1];var s=i.toLowerCase().indexOf("jpg")>=0||i.toLowerCase().indexOf("jpeg")>=0||i.toLowerCase().indexOf("png")>=0||i.toLowerCase().indexOf("gif")>=0;if(this.preloadImages==true&&s){var o=new Image;this.images[this.currentAsset.name]=o;Utensil.addListener(o,"load",function(){n.onAssetComplete()});o.src=this.currentAsset.path}else{n.onAssetComplete()}}}},onAssetComplete:function(e){this.currentAsset=null;if(this.currentIndex>=this.totalAssets){this.currentIndex=0;if(this.copyUrl){Utensil.URLLoader.load(this.copyUrl,this.onCopyLoaded)}else{Event.dispatch(this,Event.COMPLETE)}}else{this.loadAsset()}},onAssetLoaded:function(t,x){if(t)ResourceManager.assetJson[ResourceManager.currentIndex]=eval("("+t+")");ResourceManager.currentIndex++;ResourceManager.checkAssetJson(ResourceManager.currentIndex)},onCopyLoaded:function(t,x){ResourceManager.copy=eval("("+t+")");Event.dispatch(ResourceManager,Event.COMPLETE)},getAssetByName:function(e){for(var t in this.assets){if(t==e){var n=this.assets[t];var r=n.path.split(".")[1];var i=r.toLowerCase().indexOf("jpg")>=0||r.toLowerCase().indexOf("jpeg")>=0||r.toLowerCase().indexOf("png")>=0||r.toLowerCase().indexOf("gif")>=0;if(this.preloadImages==true&&i){var s=this.images[n.name];return s}else{return n}}}return null},getCopyByID:function(e){if(this.copy[e])return this.copy[e]}};var Int=function(e){return parseInt(e)};var Layout=function(){};Layout.prototype={verticalGap:0,horizontalGap:0,left:0,top:0,bottom:0,right:0,arrange:function(e){}};var VerticalLayout=function(){this.arrange=function(e){var t=e.childContainer;var n=0;for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];i.style.top=n+"px";var s=i.clientHeight;if(s==0)s=i.style.height.replace("px","");n+=parseInt(s)+this.verticalGap}}};Class.extend(VerticalLayout,Layout);var HorizontalLayout=function(){this.arrange=function(e){var t=e.childContainer;var n=0;for(var r=0;r<t.childNodes.length;r++){var i=t.childNodes[r];i.style.left=n+"px";var s=i.clientWidth;if(s==0)s=i.style.width.replace("px","");n+=parseInt(s)+this.horizontalGap}}};Class.extend(HorizontalLayout,Layout);var PaddedLayout=function(){this.arrange=function(e){var t=e.childContainer;for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];var i=parseInt(r.style.left.replace("px","")?r.style.left.replace("px",""):0);var s=parseInt(r.style.top.replace("px","")?r.style.top.replace("px",""):0);r.style.top=parseInt(s+this.top)+"px";r.style.left=parseInt(i+this.left)+"px"}}};Class.extend(PaddedLayout,Layout);var GridLayout=function(){this.arrange=function(e){var t=e.wrapper?e.wrapper:e.childContainer;var n=this.left;var r=this.top;var i=0;var s=0;var o=parseInt(e.width()-this.right);this.clearGrid(t);for(var u=0;u<t.childNodes.length;u++){var a=t.childNodes[u];if(a.className.indexOf("scroll")<0&&a.className.indexOf("mcontentwrapper")<0){var f=parseInt(a.style.left.replace("px","")?a.style.left.replace("px",""):0);var l=parseInt(a.style.top.replace("px","")?a.style.top.replace("px",""):0);if(u>0){if(n+parseInt(a.clientWidth)>=o){s++;i=0;n=this.left}}if(s>0){var c=this.getChildHeight(t,s-1,i);r=parseInt(c.y)+parseInt(c.height)+parseInt(this.verticalGap)}a.style.top=parseInt(r)+"px";a.style.left=parseInt(n)+"px";a.setAttribute("gridCol",i);a.setAttribute("gridRow",s);n+=parseInt(a.clientWidth)+parseInt(this.horizontalGap);i++}}};this.getChildHeight=function(e,t,n){for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if(parseInt(i.getAttribute("gridCol"))==n&&parseInt(i.getAttribute("gridRow"))==t){return{height:i.clientHeight,y:parseInt(i.style.top.replace("px","")?i.style.top.replace("px",""):0)}}}};this.clearGrid=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];n.setAttribute("gridCol","");n.setAttribute("gridRow","")}}};Class.extend(GridLayout,Layout);var ScrollLayout=function(){this.arrange=function(e){if(!window.scrollerIndex)window.scrollerIndex=0;if(!this.trackId)this.trackId+=window.scrollerIndex;if(!this.holderId)this.holderId+=window.scrollerIndex;if(!this.thumbId)this.thumbId+=window.scrollerIndex;if(!this.thumbId)window.scrollerIndex++;this.e=e;var t=e.childContainer;e.height(this.scrollHeight);this.maxHeight=e.childContainer.clientHeight;for(var n=0;n<e.childContainer.childNodes.length;n++){var r=e.childContainer.childNodes[n];var i=r.style.top?r.style.top.replace("px",""):0;var s=r.clientHeight;var o=parseInt(i)+parseInt(s);if(o>this.maxHeight){this.maxHeight=o}}if(this.maxHeight>this.scrollHeight){this.childHeight(e.childContainer,this.maxHeight);this.removeScroller();this.createScrollbar(e)}else{this.removeScroller()}};this.createScrollbar=function(e){if(!e)return;var t=e.childContainer;if(!this.holder){this.holder=document.createElement("div");this.holder.id=this.holderId;this.holder.style.overflow="hidden";this.holder.style.position="relative";this.childHeight(this.holder,this.scrollHeight);e.display.removeChild(t);this.holder.appendChild(t);e.display.appendChild(this.holder)}if(!this.track){this.track=document.createElement("div");this.track.id=this.trackId;this.resetStyle(this.track);this.track.className=this.trackStyle;this.childHeight(this.track,this.scrollHeight);e.addUIChild(this.track);this.childX(this.track,parseInt(e.width()));this.childWidth(t,parseInt(e.width())-parseInt(this.horizontalGap));this.childWidth(this.holder,parseInt(e.width())-parseInt(this.horizontalGap))}if(!this.thumb){this.thumb=document.createElement("div");this.thumb.id=this.thumbId;this.resetStyle(this.thumb);this.thumb.className=this.thumbStyle;this.thumb.style.cursor="pointer";var n=this.scrollHeight/this.maxHeight;this.childHeight(this.thumb,n*this.scrollHeight);this.track.appendChild(this.thumb);var r=this;this.onMouseDownHandler=function(e){r.onMouseDown(e)};this.onScrollWheelHandler=function(e){r.onScrollWheel(e)};Utensil.addListener(this.thumb,"mousedown",this.onMouseDownHandler);this.addEvent(e.display,"mousewheel",this.onScrollWheelHandler)}};this.removeScroller=function(){var e=this.e.childContainer;if(this.track){if(document.getElementById(this.trackId))document.getElementById(this.trackId).parentNode.removeChild(this.track);this.track=null}if(this.thumb){if(document.getElementById(this.thumbId))document.getElementById(this.trackId).parentNode.removeChild(this.thumb);Utensil.removeListener(this.thumb,"mousedown",this.onMouseDownHandler);this.thumb=null;if(this.holder){if(document.getElementById(this.holderId)){this.e.display.removeChild(this.holder);this.holder.removeChild(e)}this.e.display.appendChild(e);this.holder=null}this.removeEvent(this.e.display,"mousewheel",this.onScrollWheelHandler)}this.reset()};this.reset=function(){this.e.childContainer.style.top="0px"};this.onScrollWheel=function(e){e=e?e:window.event;var t=e.detail?e.detail*-1:e.wheelDelta/40;this.startY=parseInt(this.childY(this.thumb))+Number(t);this.onMouseMove(e,parseInt(this.childY(this.thumb))-Number(t*10))};this.onMouseDown=function(e){this.startX=Utensil.mouseX(document.body,e);this.startY=Utensil.mouseY(document.body,e)-this.childY(this.thumb);var t=this;this.onMouseMoveHandler=function(e){t.onMouseMove(e)};this.onMouseUpHandler=function(e){t.onMouseUp(e)};Utensil.addListener(document,"mousemove",this.onMouseMoveHandler);Utensil.addListener(document,"mouseup",this.onMouseUpHandler);if(e&&e.preventDefault){e.preventDefault()}else{window.event.returnValue=false}return false};this.onMouseMove=function(e,t){var n=t!=undefined?t:Utensil.mouseY(document.body,e)-this.startY;var r=0;if(n<=0)n=0;if(Number(n)+parseInt(this.thumb.clientHeight)>=this.scrollHeight){n=this.scrollHeight-parseInt(this.thumb.clientHeight);r=this.paddingBottom}this.childY(this.thumb,n);var i=this.maxHeight/this.scrollHeight;this.e.childContainer.style.top=-(parseInt(this.childY(this.thumb)*i)+r)+"px";if(e&&e.preventDefault){e.preventDefault()}else{window.event.returnValue=false}return false};this.onMouseUp=function(e){Utensil.removeListener(document,"mousemove",this.onMouseMoveHandler);Utensil.removeListener(document,"mouseup",this.onMouseUpHandler)};this.childX=function(e,t){if(t==undefined){return e.style.left?e.style.left.replace("px",""):0}else{e.style.left=t+"px"}};this.childY=function(e,t){if(t==undefined){return e.style.top?e.style.top.replace("px",""):0}else{e.style.top=t+"px"}};this.childWidth=function(e,t){if(t==undefined){return e.style.width?e.style.width.replace("px",""):0}else{e.style.width=t+"px"}};this.childHeight=function(e,t){if(t==undefined){return e.style.height?e.style.height.replace("px",""):0}else{e.style.height=t+"px"}};this.resetStyle=function(e){e.style.position="absolute";e.style.top="0px"};this.addEvent=function(e,t,n){if(typeof e=="string")e=document.getElementById(e);if(e==null)return;if(e.addEventListener){if(t=="mousewheel")e.addEventListener("DOMMouseScroll",n,false);e.addEventListener(t,n,false)}else if(e.attachEvent)e.attachEvent("on"+t,n)};this.removeEvent=function(e,t,n){if(typeof e=="string")e=document.getElementById(e);if(e==null)return;if(e.removeEventListener){if(t=="mousewheel")e.removeEventListener("DOMMouseScroll",n,false);e.addEventListener(t,n,false)}else if(e.detachEvent)e.detachEvent("on"+t,n)}};Class.extend(ScrollLayout,Layout);var _=ScrollLayout.prototype;_.track;_.thumb;_.holder;_.scrollHeight=10;_.paddingBottom=10;_.trackStyle="scrollTrack";_.thumbStyle="scrollThumb";_.holderId="scrollHolder";_.trackId="scrollTrack";_.thumbId="scrollThumb";_.e;_.startX;_.startY;_.maxHeight=0;var DisplayObject=function(){this.display=null;this.elemName="div"};DisplayObject.prototype={props:{},style:function(e){e.style.position="absolute"},init:function(){var e=document.createElement(this.elemName);this.display=e;for(prop in this.props){this.styleProp(prop,this.props[prop].value,this.props[prop].suffix)}this.style(e)},styleProp:function(e,t,n){if(!this.display){this.props[e]={value:t,suffix:n};return t}if(t!=undefined){this.display.style[e]=t+(n?n:"")}else{return this.display.style[e]?this.display.style[e].replace("px",""):""}},className:function(e){if(e!=undefined){this.display.className=e}else{return this.display.className}},x:function(e){return Number(this.styleProp("left",e,"px"))},y:function(e){return Number(this.styleProp("top",e,"px"))},width:function(e){return Number(this.styleProp("width",e,"px"))},height:function(e){return Number(this.styleProp("height",e,"px")!=""?this.styleProp("height",e,"px"):this.display.clientHeight)},visible:function(e){if(e!=undefined){e==true?e="visible":e="hidden";this.styleProp("visibility ",e)}else{return this.styleProp("visibility ",e)=="visible"?true:false}},alpha:function(e){if(e!=undefined){this.props.alpha=e;if(this.display){this.display.style["opacity"]=e;this.display.style["-khtml-opacity"]=e;this.display.style["-moz-opacity"]=e;this.display.style["filter"]="alpha(opacity="+e*100+")"}}else{return Number(this.props.alpha==undefined?1:this.props.alpha)}},buttonMode:function(e){if(e==true){this.display.style.cursor="pointer"}else{this.display.style.cursor="auto"}},startX:function(){var e=this.x();if(Utensil.getX(this.display,true)>e){return Utensil.getX(this.display,true)-e}return e},startY:function(){var e=this.y();if(Utensil.getY(this.display,true)>e){return Utensil.getY(this.display,true)-e}return e},startDrag:function(){var e="mousemove";if("ontouchstart"in document.documentElement)e="ontouchstart";var t=this;var n=this.startX();var r=this.startY();this.dragHandler=function(e){t.onDragMove(e,n,r)};Utensil.addListener(document,e,this.dragHandler)},onDragMove:function(e,t,n){this.x(Utensil.mouseX(document.body,e)-t);this.y(Utensil.mouseY(document.body,e)-n)},stopDrag:function(){var e="mousemove";if("ontouchstart"in document.documentElement)e="ontouchstart";Utensil.removeListener(document,e,this.dragHandler)},hitTestObject:function(e){var t=parseInt(this.x());var n=parseInt(e.x());var r=t+parseInt(this.width());var i=n+parseInt(e.width());var s=parseInt(this.y());var o=parseInt(e.y());var u=s+parseInt(this.height());var a=o+parseInt(e.height());if(r>=n&&t<=i){}else{return false}if(u>=o&&s<=a){}else{return false}return true},hitTestPoint:function(e,t){if(e>=this.x()&&e<=parseInt(this.x())+parseInt(this.width())&&t>=this.y()&&t<=parseInt(this.y())+parseInt(this.height())){return true}return false}};var UIElement=function(){};(function(){var e=Class.extend(UIElement,DisplayObject);e.layoutCollection=null;e.childContainer=null;e.state="";e.build=function(){Class._super(this,"init");var e=document.createElement("div");this.childContainer=e;this.display.appendChild(e);this.styleChildContainer()};e.styleChildContainer=function(){this.childContainer.style.position="relative";this.childContainer.style.display="block"};e.addChild=function(e){this.childContainer.appendChild(e.display?e.display:e)};e.removeChild=function(e){this.childContainer.removeChild(e.display?e.display:e)};e.addUIChild=function(e){this.display.appendChild(e.display?e.display:e)};e.removeUIChild=function(e){if(!e)return;this.display.removeChild(e.display?e.display:e)};e.layout=function(e){if(!this.layoutCollection)this.layoutCollection=[];if(e!=undefined){this.layoutCollection.push(e)}else{return this.layoutCollection[this.layoutCollection.length-1]}};e.setStyle=function(){};e.arrange=function(){if(!this.layoutCollection)return;for(var e=0;e<this.layoutCollection.length;e++){this.layoutCollection[e].arrange(this)}};e.bareWidth=function(){return this.childContainer.clientWidth};e.bareHeight=function(){return this.childContainer.clientHeight}})();var Label=function(){this.field;this.text=function(e){if(!this.field){this.field=document.createElement("div");this.field.style.position="relative";this.addChild(this.field)}if(e!=undefined){this.field.innerHTML=e}else{return this.field.innerHTML}}};(function(){var e=Class.extend(Label,UIElement)})();var Button=function(){};(function(){var e=Class.extend(Button,UIElement);e.bgImage=null;e.buttonMouseOver=null;e.buttonMouseOut=null;e.buttonMouseClick=null;e.labelClassName=function(e){this.label.className(e)};e.label=null;e.build=function(){Class._super(this,"build");this.label=new Label;this.label.build();this.label.text("");this.addChild(this.label);this.disableSelection(this.label.display)};e.setStyle=function(){Class._super(this,"setStyle");this.label.width(this.width());if(!this.labelClassName){this.label.display.style.textAlign="center"}};e.asset=function(e){if(e){this.bgImage=new Image;this.bgImage.src=typeof e=="object"?e.src:e;this.display.style.backgroundImage="url("+this.bgImage.src+")"}};e.text=function(e){if(e!=undefined){this.label.display.innerHTML=e}else{return this.label.displayinnerHTML}};e.activate=function(){this.display.style.cursor="pointer";var e=this;this.buttonMouseOver=function(t){e.onMouseOver(t)};this.buttonMouseOut=function(t){e.onMouseOut(t)};this.buttonMouseClick=function(t){e.onMouseClick(t)};Utensil.addListener(this.display,"mouseover",this.buttonMouseOver);Utensil.addListener(this.display,"mouseout",this.buttonMouseOut);Utensil.addListener(this.display,"mousedown",this.buttonMouseClick)};e.deactivate=function(){this.display.style.cursor="default";Utensil.removeListener(this.display,"mouseover",this.buttonMouseOver);Utensil.removeListener(this.display,"mouseout",this.buttonMouseOut);Utensil.removeListener(this.display,"mousedown",this.buttonMouseClick);this.buttonMouseOver=null;this.buttonMouseOut=null};e.onMouseOver=function(e){this.display.style.backgroundPosition="0px -"+this.height()+"px"};e.onMouseOut=function(e){this.display.style.backgroundPosition="0px "+"0px"};e.onMouseClick=function(e){this.display.style.backgroundPosition="0px -"+this.height()*2+"px"};e.disable=function(){this.deactivate();this.display.style.backgroundPosition="0px -"+this.height()*3+"px"};e.disableSelection=function(e){e.style["-moz-user-select"]="-moz-none";e.style["-khtml-user-select"]="none";e.style["-ms-user-select"]="none";e.style["user-selectt"]="none";e.style["-webkit-user-select"]="none"}})();var Sprite=function(){};(function(){var e=Class.extend(Sprite,UIElement);e.lineStyle=function(e,t){var n=e!=undefined?e:1;var r=t!=undefined?t:"#000";this.display.style.border="solid "+n+"px "+r;delete n;delete r};e.drawRect=function(e,t,n,r,i,s){this.x(e);this.y(t);this.width(n);this.height(r);this.setColor(i)};e.drawRoundRect=function(e,t,n,r,i,s){this.x(e);this.y(t);this.width(n);this.height(r);this.setColor(s);this.setCorners(i)};e.drawCircle=function(e,t,n,r){this.x(e);this.y(t);this.width(n*2);this.height(n*2);this.setColor(r);this.setCorners(n)};e.setColor=function(e){if(e)this.display.style.backgroundColor=e};e.setCorners=function(e){this.display.style.behavior="url(lib/com/wezside/component/border-radius.htc)";this.display.style.webkitBorderRadius=e+"px";this.display.style.MozBorderRadius=e+"px";this.display.style["-moz-border-radius"]=e+"px";this.display.style.borderRadius=e+"px";this.display.style["border-radius"]=e+"px "+e+"px "+e+"px "+e+"px"}})();var Engine=function(){this.event={READY:"ENGINE_READY"};this.prop={width:0,height:0,grid:false,cellSize:10,gridCellIndex:0,gridCellId:"cell-",occupiedXY:[],ignoreCells:[],layer:{bgId:"engineBGLayer",character:"engineCharacterLayer",front:"engineFrontLayer"},container:null};this.holder=null;this.container=function(e){if(e==undefined){var t;if(!this.prop.container){t=document.body}else{t=document.getElementById(this.prop.container)}return t}this.prop.container=e};this.showGrid=function(e){if(e==undefined){return this.prop.grid}else{this.prop.grid=e}};this.init=function(){this.createGrid();this.astar.parent=this};this.createGrid=function(){this.holder=new UIElement;this.holder.build();this.holder.width(this.width());this.holder.height(this.height());this.holder.setStyle();var e=parseInt(this.width()/this.cellSize());var t=parseInt(this.height()/this.cellSize());this.astar.rows=t;this.astar.cols=e;var n=0;var r=0;var i=false;var s;while(!i){if(!this.astar.grid[n])this.astar.grid[n]=[];this.astar.setCell(n,r,false);if(this.prop.grid){s=new Sprite;s.build();s.lineStyle();s.drawRect(r*this.cellSize(),n*this.cellSize(),this.cellSize(),this.cellSize(),null);s.setStyle();this.holder.addChild(s);s.arrange();s.display.id=this.prop.gridCellId+r+"_"+n}this.prop.gridCellIndex++;r++;if(r>=e){n++;r=0}if(n>=t){i=true}}this.holder.arrange();this.createLayers();this.container().appendChild(this.holder.display)};this.createLayers=function(){var e=new UIElement;e.build();e.width(this.width());e.height(this.height());e.setStyle();e.arrange();e.display.id=this.prop.layer.bgId;this.holder.addChild(e);e=new UIElement;e.build();e.width(this.width());e.height(this.height());e.setStyle();e.arrange();e.display.id=this.prop.layer.character;this.holder.addChild(e);e=new UIElement;e.build();e.width(this.width());e.height(this.height());e.setStyle();e.arrange();e.display.id=this.prop.layer.front;this.holder.addChild(e)};this.addToBackgroundLayer=function(e){var t=document.getElementById(this.prop.layer.bgId);if(e.display){t.appendChild(e.display)}else{t.appendChild(e)}};this.addToCharacterLayer=function(e){var t=document.getElementById(this.prop.layer.character);if(e.display){t.appendChild(e.display)}else{t.appendChild(e)}};this.addToFrontLayer=function(e){var t=document.getElementById(this.prop.layer.front);if(e.display){t.appendChild(e.display)}else{t.appendChild(e)}};this.setCell=function(e,t,n){var r=this.prop.gridCellId+e+"_"+t;var i=document.getElementById(r);if(!i)return;i.style.backgroundColor=n?n:"#f00"};this.ignoreBlocks=function(e,t){var n=this.getXCell(t==undefined?e.x():e);var r=this.getYCell(t==undefined?e.y():t);var i=this.getXCell(t==undefined?Int(e.x())+Int(e.width()):e);var s=this.getYCell(t==undefined?Int(e.y())+Int(e.height()):t);var o=false;var u=n;while(!o){this.setIgnoreXY(u,r);u++;if(u>=i){u=n;r++}if(r>=s)o=true}};this.addObstacle=function(e,t){var n=this.getXCell(t==undefined?e.x():e);var r=this.getYCell(t==undefined?e.y():t);var i=this.getXCell(t==undefined?Int(e.x())+Int(e.width()):e);var s=this.getYCell(t==undefined?Int(e.y())+Int(e.height()):t);var o=n;var u=r;while(o<i){while(u<s){this.setOccupiedXY(o,u);this.astar.setCell(u,o,true);u++}u=r;o++}delete o;delete u;delete n;delete r;delete i;delete s};this.setOccupiedXY=function(e,t){if(!this.prop.occupiedXY[e])this.prop.occupiedXY[e]=[];this.prop.occupiedXY[e][t]=e+","+t};this.setIgnoreXY=function(e,t){if(!this.prop.ignoreCells[e])this.prop.ignoreCells[e]=[];this.prop.ignoreCells[e][t]=e+","+t};this.getOccupiedXY=function(e,t){var n;var r;if(e.x){n=this.getXCell(e.x());r=this.getYCell(e.y());var i=this.getXCell(Int(e.x())+Int(e.width()));var s=this.getYCell(Int(e.y())+Int(e.height()));var o=n;var u=false;var a=false;while(!a){if(this.prop.occupiedXY[o]&&this.prop.occupiedXY[o][r])u=true;o++;if(o>=i){o=n;r++}if(r>s)a=true}if(u)return true}else{n=this.getXCell(e);r=this.getYCell(t);if(this.prop.occupiedXY[n]&&this.prop.occupiedXY[n][r])return true}return false};this.findPathTo=function(e,t,n){var r=this.getXCell(e.x());var i=this.getYCell(e.y());var s=this.getXCell(t);var o=this.getYCell(n);this.setCell(r,i,"purple");this.setCell(s,o,"yellow");return this.astar.search(r,i,s,o)};this.drawPath=function(e){if(!this.prop.grid)return;for(var t=0;t<e.length;t++){this.setCell(e[t][0],e[t][0],"#00f")}};this.getXCell=function(e){return Math.floor(e/this.cellSize())};this.getYCell=function(e){return Math.floor(e/this.cellSize())};this.cellSize=function(e){if(e==undefined){return this.prop.cellSize}else{this.prop.cellSize=e}};this.width=function(e){if(e==undefined){return this.prop.width}else{this.prop.width=e}};this.height=function(e){if(e==undefined){return this.prop.height}else{this.prop.height=e}};this.astar={grid:[],opened:[],start:null,target:null,parent:null,last:null,rows:0,cols:0,pos:function(e,t){this.x=e;this.y=t;this.cost=0;this.totalcost=0;this.blocked=false;this.closed=false;this.prev=null;this.str=function(){return this.x+","+this.y};this.equal=function(e){return this.x==e.x&&this.y==e.y}},opencell:function(e,t,n){if(!e||e.blocked)return null;if(n&&n.prev&&!n.equal(this.start)){if(e.x-n.x!=n.x-n.prev.x||e.y-n.y!=n.y-n.prev.y)t+=4}var r=parseFloat(t)+14*(Math.abs(e.x-this.target.x)+Math.abs(e.y-this.target.y));if(e.totalcost!=0){if(r<e.totalcost){var i;for(i=0;i<this.opened.length;++i){if(e.equal(this.opened[i])){this.opened.splice(i,1);break}}}else return null}e.cost=t;e.prev=n;e.totalcost=r;var s=0;for(s=0;s<this.opened.length;++s){if(e.totalcost<this.opened[s].totalcost){this.opened.splice(s,0,e);break}}if(s>=this.opened.length)this.opened[s]=e;if(!this.grid[e.y])return null;this.grid[e.y][e.x]=e;this.last=e;return e},openadjacent:function(e){var t=this.grid[e.y][e.x].cost+10;if(e.x>0)this.opencell(this.grid[e.y][e.x-1],t,e);if(e.y>0)this.opencell(this.grid[e.y-1][e.x],t,e);if(e.y<this.rows-1)this.opencell(this.grid[e.y- -1][e.x],t,e);if(e.x<this.cols-1)this.opencell(this.grid[e.y][e.x- -1],t,e)},search:function(e,t,n,r){var i;var s=0;this.setstart(new this.pos(e,t));this.settarget(new this.pos(n,r));i=this.opencell(this.start,0,this.start);while(i&&!i.equal(this.target)){i.closed=true;this.opened.shift();this.openadjacent(i);if(this.opened.length>0)i=this.opened[0];else i=null;if(++s>1e4){i=null;break}}if(!i){return}var o=[];while(!i.equal(this.start)){o.push({x:i.x*this.parent.cellSize(),y:i.y*this.parent.cellSize()});this.parent.setCell(i.x,i.y,"#00f");i=i.prev;if(!i){break}}if(o)o.reverse();return o},setCell:function(e,t,n){if(!this.grid[e])return;this.grid[e][t]={};this.grid[e][t].cost=0;this.grid[e][t].totalcost=0;this.grid[e][t].prev=null;this.grid[e][t].closed=false;this.grid[e][t].blocked=n?true:false;this.grid[e][t].x=t;this.grid[e][t].y=e;this.grid[e][t].str=function(){return this.x+","+this.y};this.grid[e][t].equal=function(e){return this.x==e.x&&this.y==e.y};if(n)this.parent.setCell(t,e,"#f00")},setblock:function(e,t,n,r){for(var i=e.y;i<=t.y;++i){for(var s=e.x;s<=t.x;++s){if(!r.grid[i]||!r.grid[i][s])return;if(n){r.parent.setCell(s,i,"#f00");r.grid[i][s].blocked=true}else{r.parent.setCell(s,i);r.grid[i][s].blocked=false}}}},wipe:function(){var e,t;if(!this.parent||!this.start)return;this.opened=[];for(e=0;e<this.rows;++e){for(t=0;t<this.cols;++t){this.grid[e][t].cost=0;this.grid[e][t].totalcost=0;this.grid[e][t].prev=null;this.grid[e][t].closed=false;if(this.grid[e][t].blocked)this.parent.setCell(t,e,"#f00");else this.parent.setCell(t,e,"#fff")}}this.parent.setCell(this.start.x,this.start.y,"none");this.parent.setCell(this.target.x,this.target.y,"none")},setstart:function(e){if(this.start){this.parent.setCell(e.x,e.y,"yellow")}this.start=e;this.parent.setCell(e.x,e.y,"purple")},settarget:function(e){if(this.target){this.parent.setCell(e.x,e.y,"yellow")}this.target=e;this.parent.setCell(e.x,e.y,"yellow")}}}